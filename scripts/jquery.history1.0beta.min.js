(function(b){function a(){this._curHash="";this._callback=function(c){}}b.extend(a.prototype,{init:function(d){this._callback=d;this._curHash=location.hash;this._lastHash=location.hash;this.isSafari=false;if((navigator.userAgent).indexOf("Safari")>-1){this.isSafari=true}this.isIE=false;if((navigator.userAgent).indexOf("MSIE")>-1){this.isIE=true}this.isChrome=false;if((navigator.userAgent).indexOf("Chrome")>-1){this.isChrome=true}if(this.isIE){if(this._curHash==""){this._curHash="#"}b("body").prepend('<iframe id="jQuery_history" style="display: none;" ></iframe>');var c=b("#jQuery_history")[0].contentWindow.document;c.open();c.close();c.location.hash=this._curHash}else{if(this.isSafari){this._historyBackStack=[];this._historyBackStack.length=history.length;this._historyForwardStack=[];this._isFirst=true;this._dontCheck=false}}this._callback(this._curHash.replace(/^#/,""));setInterval(this._check,100)},add:function(c){this._historyBackStack.push(c);this._historyForwardStack.length=0;this._isFirst=true},_check:function(){if(this.isIE){var c=b("#jQuery_history")[0];try{var g=c.contentDocument||c.contentWindow.document;var k=g.location.hash;if(k!=b.history._curHash){location.hash=k;b.history._curHash=k;b.history._callback(k.replace(/^#/,""))}}catch(j){var k=location.hash;if(k!=this._lastHash){b.history._callback(k.replace(/^#/,""));this._lastHash=k}}}else{if(this.isSafari){if(!b.history._dontCheck){var d=history.length-b.history._historyBackStack.length;if(d){b.history._isFirst=false;if(d<0){for(var f=0;f<Math.abs(d);f++){b.history._historyForwardStack.unshift(b.history._historyBackStack.pop())}}else{for(var f=0;f<d;f++){b.history._historyBackStack.push(b.history._historyForwardStack.shift())}}var h=b.history._historyBackStack[b.history._historyBackStack.length-1];if(h!=undefined){b.history._curHash=location.hash;b.history._callback(h)}}else{if(b.history._historyBackStack[b.history._historyBackStack.length-1]==undefined&&!b.history._isFirst){if(document.URL.indexOf("#")>=0){b.history._callback(document.URL.split("#")[1])}else{b.history._callback("")}b.history._isFirst=true}}}var k=location.hash;if(k!=b.history._curHash){b.history._curHash=k;b.history._callback(k.replace(/^#/,""))}}else{var k=location.hash;if(k!=b.history._curHash){b.history._curHash=k;b.history._callback(k.replace(/^#/,""))}}}},load:function(h){var i;if(b.browser.safari){i=h}else{i="#"+h;location.hash=i}this._curHash=i;if(this.isIE){try{var c=b("#jQuery_history")[0];var f=c.contentWindow.document;f.open();f.close();f.location.hash=i;this._callback(h)}catch(g){}}else{if(this.isSafari){this._dontCheck=true;this.add(h);var d=function(){b.history._dontCheck=false};window.setTimeout(d,200);this._callback(h);location.hash=i}else{this._callback(h)}}}});b(document).ready(function(){b.history=new a()})})(jQuery);