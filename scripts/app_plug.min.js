var env_subjects="http://staging-subjects.thlib.org";var env_mms="http://staging-mms.thlib.org";$(document).ready(function(){ActivateAppLinks.init();GetCSS();thlplug.init()});var ActivateAppLinks={EnableKillers:function(){var b=new Array("http://dev-subjects.thlib.org","http://staging-subjects.thlib.org","http://subjects.thlib.org","http://dev-mms.thlib.org","http://staging-mms.thlib.org","http://mms.thlib.org","http://dev-places.thlib.org","http://staging-places.thlib.org","http://places.thlib.org");if(top==self&&typeof frame_service=="undefined"){var a=b.length-1;do{arg="body a[href^="+b[a]+"]"}while(a--)}},EnableIframeLinks:function(){$("a[href*=#iframe]").click(function(){thlplug.swap(this.href)})},init:function(){this.EnableKillers();if($("#loadingFrame").length==0){$("#body-wrapper").append('<div id="loadingFrame" style="display:none;"><p><img src="/global/images/ajax-loader.gif" />  Loading ...</p></div>')}this.EnableIframeLinks()}};function GetCSS(){var b=$("link[rel^=stylesheet]").attr("href");var c="";if(typeof(b)!="string"){return}if(b.indexOf("http://")==-1){var a=window.location.hostname;if(a.indexOf("places")==-1){c=window.location.protocol+"//"+window.location.hostname}else{c="http://staging.thlib.org/"}}c+=b;thlplug.css_url=c}var thlplug={div_id:"content",css_url:"",iframe_id:"thl_app",url_hash:"",bookmark_arg:"iframe=",iframe_html:"<iframe id='{id}' name='{id}' src='{src}' width='{x}' height='{y}' frameborder='0' scrolling='no' style='border:0pt; margin:0px; padding:0pt; overflow-x:hidden; overflow-y:hidden' onload='$(\"#loadingFrame\").hide();'> </iframe>",content_old:"",do_subs:function(c){dims=this.dims_get(this.iframe_tokens.iframe);c=c.replace(/{id}/g,this.iframe_id);if(c.indexOf("{src}")>-1){c=c.replace(/{src}/,this.app_url)}else{var a=c.split(/css_url/);a[0]=a[0].replace(/src=\'.+/,"src='"+this.iframe_tokens.iframe);var b=a[0].indexOf("?")==-1?"?":"&";a[1]=b+"css_url"+a[1];c=a[0]+a[1]}c=c.replace(/{x}/,dims.x);c=c.replace(/{y}/,dims.y);return c},dims_get:function(a){var c=new Object();if(typeof(this.dim_arr)!="undefined"&&typeof(this.dim_arr[a])=="object"){var b=this.dim_arr[a];c.y=b.y>0?this.target_div.y+(b.y-this.target_div.y)+10:this.target_div.y;c.x=b.x>0?this.target_div.x+(b.x-this.target_div.x):this.target_div.x}else{c.y=this.target_div.y;c.x=this.target_div.x}return c},dims_load:function(){this.dim_arr=new Array();this.dim_arr[env_subjects+"/categories/119/children"]={y:1043,x:0};this.dim_arr[env_mms+"/media_collection_associations?collection_id=22"]={y:577,x:0}},iframe_check:function(){var c=window.location;if(top!=self&&typeof frame_service=="undefined"&&c.search.indexOf("frame=create")==-1&&(document.referrer.indexOf("parent_url=")!=-1||c.search.indexOf("parent_url=")!=-1)){var b=c.search?"&":"?";var a=c.search.replace("frame=destroy","");window.location=c.protocol+"//"+c.host+c.pathname+a+b+"frame=create"+c.hash}},init:function(){this.iframe_check();this.dims_load();if(window.location.hash.indexOf("iframe=")>-1){setTimeout("thlplug.swap( window.location.href );",500)}},kill_old:function(){if(this.target_div){this.target_div.html(this.content_old);this.status="off"}},swap:function(b){this.kill_old();window.document.domain="thlib.org";this.status="on";iframe_tokens=this.tokenize(b);if(typeof(showLoadingFrame)=="boolean"&&showLoadingFrame===true){$("#loadingFrame").show()}this.div_id=!iframe_tokens.div_id?this.div_id:iframe_tokens.div_id;if(this.css_url==""&&typeof(iframe_tokens.css_url)=="undefined"){GetCSS()}this.css_url=!iframe_tokens.css_url?this.css_url:iframe_tokens.css_url;this.parent_url=iframe_tokens.parent_url;this.target_div=$("#"+this.div_id);this.target_div.x=this.target_div.width();this.target_div.y=this.target_div.height();if(iframe_tokens.iframe.indexOf("|hash|")>-1){var a=iframe_tokens.iframe.split("|hash|");iframe_tokens.iframe=a[0];this.url_hash="#"+a[1]}if(this.content_old==""){this.content_old=this.target_div.html()}this.app_url=iframe_tokens.iframe+(iframe_tokens.iframe.indexOf("?")>-1?"&":"?")+"css_url="+this.css_url+"&parent_url="+iframe_tokens.parent_url+"&x="+this.target_div.x+"&y="+this.target_div.y+this.url_hash;this.iframe_html=this.do_subs(this.iframe_html);var c='<div style="position:relative;vertical-align:bottom;text-align:center"><a href="javascript:self.scrollTo(0,0)">Back to Top</a></div>';this.target_div.html(this.iframe_html+c);this.iframe_obj=document.getElementById(this.iframe_id);if($("#side-home-link").length){$("#side-home-link").show().css({"line-height":"normal",visibility:"visible"})}if($("#fxSideMenu").is(":visible")){$("#sideMenuLink").click()}},swap_undo:function(){this.kill_old();this.target_div.show()},tokenize:function(b){this.iframe_tokens=new Array();iframe_regex=new RegExp(this.bookmark_arg+"(((?!&div_id|&css_url?=).)+)");frame_arr=b.match(iframe_regex);this.iframe_tokens.iframe=frame_arr[1];data_split=b.match(/([^=&#]+)=([^&]*)/g);var a=data_split.length-1;do{if(a>0){zitem=data_split[a];arg_arr=zitem.split("=");arg=arg_arr[0];this.iframe_tokens[arg]=arg_arr[1]}}while(a--);parent_data=window.location.href.split("#");this.iframe_tokens.parent_url=parent_data[0];return this.iframe_tokens}};function set_iframe_height(a){$("#"+thlplug.iframe_id).css("height",a+"px")};