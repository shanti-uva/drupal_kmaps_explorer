var THLTibetanTranslationPlugin={apiUrl:"http://ttt.thlib.org/org.thdl.tib.scanner.RemoteScannerFilter?jwf=?&text=",isIE:document.all?true:false,selectedText:"",popup:null,wordsDiv:null,queryAPI:function(b){b=escape(this.encodeUtf8(b));var a=this.apiUrl+b;jQuery.ajax({type:"GET",dataType:"json",url:a,error:function(c){THLTibetanTranslationPlugin.setContent("Sorry, there was an error with this request.")},success:function(c){THLTibetanTranslationPlugin.displayWords(c)}})},translate:function(a){this.createBox();this.showBox();this.queryAPI(a)},checkSelection:function(){if(this.selectedText==""){alert("Please select some Tibetan text or Wylie transliteration to be translated before using this translation tool.");return false}return true},createBox:function(){var a=jQuery().thlPopup({id:"thl_tt_plugin",footer:'Courtesy of the <a href="http://www.thlib.org" target="_blank">THL</a> <a href="http://www.thlib.org/reference/dictionaries/tibetan-dictionary/translate.php" target="_blank">Tibetan Translation Plugin</a>',flexibleHeight:true,overflow:"auto",open:false});this.popup=a;this.wordsDiv=a.contentDiv},showBox:function(){this.setContent('<img src="http://thlib.org/global/images/ajax-loader.gif" alt="" /> Searching...');this.popup.open()},setContent:function(a){this.popup.setContent(a)},displayWords:function(a){this.setContent(this.formatWords(a));this.wordsDiv.get(0).scrollTop=0;this.popup.center()},formatWords:function(c){var f=c.words;var a=false;var d='<div class="thl-tt-plugin">';var e;for(key in f){a=true}if(!a){d="Sorry, no results for this text were found."}else{for(key in f){e=f[key];d+="<dl><dt>"+key+"</dt><dd>";if(e.length==0){d+="Sorry, this word wasn't found."}else{d+="<table>";for(var b=0;b<e.length-1;b+=2){d+='<tr><td class="word">'+e[b]+"</td><td>"+e[b+1]+"</td></tr>"}d+="</table>"}d+="</dd></dl>"}}d+="</div>";return d},translateSelectedText:function(){if(this.checkSelection()){var a=this.selectedText+"";a=a.replace(/\[[^\]]+\]/g,"");a=a.replace(/\u200b/g,"");this.translate(a)}return false},onKeyDown:function(c){var a=(c.keyCode?c.keyCode:c.which);var b=c.ctrlKey;if(b&&(a==191||a==79)){this.translateSelectedText()}},onMouseUp:function(a){this.setSelectedText();return true},setSelectedText:function(){var b;if(document.getSelection){b=document.getSelection()}else{if(document.selection&&document.selection.createRange){var a=document.selection.createRange();b=a.text}else{b=window.getSelection()+""}}this.selectedText=b},encodeUtf8:function(b){b=b+"";b=b.replace(/\n/g," ");b=b.replace(/\r/g," ");var e,a="";for(var d=0;d<b.length;d++){e=b.charCodeAt(d);if(e<128){a+=String.fromCharCode(e)}else{if((e>127)&&(e<2048)){a+=String.fromCharCode((e>>6)|192);a+=String.fromCharCode((e&63)|128)}else{a+=String.fromCharCode((e>>12)|224);a+=String.fromCharCode(((e>>6)&63)|128);a+=String.fromCharCode((e&63)|128)}}}return a}};jQuery(document).ready(function(){jQuery(document).bind("mouseup",function(a){THLTibetanTranslationPlugin.onMouseUp(a)});jQuery(document).bind("keydown",function(a){THLTibetanTranslationPlugin.onKeyDown(a)})});