function Menu(b,d){var d=jQuery.extend({content:null,positionOpts:{offsetY:5},width:216,maxHeight:200,showSpeed:500,callerOnState:"btnMenuOn",itemHover:"hover",altClasses:null,crossSpeed:200,selectCategories:false,nextMenuLink:"nextLevel",topLinkText:"All"},d);var c=$(b);var e=$('<div class="menuContainer">'+d.content+"</div>");var a=false;if(d.selectCategories){e.find("li:has(ul)").each(function(){$(this).find("a:first").after('<a href="#" class="'+d.nextMenuLink+'">View next level &gt;</a>')})}this.create=function(){if(d.content){e.css({position:"absolute",top:0,left:"-9999px"});if(d.altClasses){e.addClass(d.altClasses)}if(c.width()>e.width()){e.css({width:c.width()})}e.appendTo("body").setRandomId({attribute:"menuid"}).css({width:d.width}).find("ul:first").addClass("menu").css({position:"relative"});$("*[menuid]").parent().trigger("click");if(d.callerOnState){c.addClass(d.callerOnState)}if(e.children("ul").size()>0){this.drilldown(e,d)}e.positionObject(c,d.positionOpts).hide().slideDown(d.showSpeed).find(".menu:eq(0)").css({visibility:"visible"});a=true;e.parent().click(this.kill);$(document).click(this.kill);if(d.itemHover){e.find("li").hover(function(){$(this).siblings().removeClass(d.itemHover);$(this).addClass(d.itemHover)},function(){$(this).removeClass(d.itemHover)})}var f=this;if(d.selectCategories){$(".ddMenu li a").not("."+d.nextMenuLink).click(function(){alert("You chose "+$(this).text());f.kill();return false})}else{$(".ddMenu li a").not(".menuIndicator").click(function(){alert("You chose "+$(this).text());f.kill();return false})}}};this.kill=function(){e.parent().remove();if(c.is("."+d.callerOnState)){c.removeClass(d.callerOnState)}a=false};return this}Menu.prototype.drilldown=function(e,c){var f=$('<ul class="ddBreadcrumb clearfix" style="display: none;"></ul>');var b=$('<div class="ddMenu"></div>');e.css({overflow:"hidden"}).children().eq(0).wrap(b);e.prepend(f);var d=[];e.find(".ddMenu").find("ul").each(function(g){d[g]=$(this).height()});d.sort(sortBigToSmall);e.find(".ddMenu").find("ul").css({height:d[0]});if(d[0]>c.maxHeight){e.find(".ddMenu").addClass("scrollNeeded").css({height:c.maxHeight,overflow:"auto","overflow-x":"hidden"}).find("ul").css({width:(c.width-15).pxToEm()})}else{e.find(".ddMenu").css({height:d[0]}).find("ul").css({width:c.width})}e.find(".ddMenu li a").each(function(){if(!$(this).next().is("."+c.nextMenuLink)){$(this).addClass("singleLink")}});var a=function(m){var j=$(m);var l=$(m).parents("ul:eq(0)");var i=$(m).next();var h=l.attr("id");if(f.find("li").size()<1){var k=$('<li class="all"><a href="#">'+c.topLinkText+"</a></li>");k.click(function(){e.find("ul").not("ul.menu, .ddBreadcrumb").css({visibility:"hidden"});f.empty().hide();return false});f.append(k)}var g=function(){var o;if(j.prev().is("a")){o=j.prev().html()}else{o=j.html()}var n=$('<li class="currentCrumb" style="display: none;"><a href="javascript://" class="crumb">'+o+"</a></li>");$(".currentCrumb").removeClass("currentCrumb");f.append(n);n.show();n.find("a").click(function(){if($(this).parent().is(".currentCrumb")){alert("You chose "+$(this).text());e.kill();return false}else{i.find("ul").css({visibility:"hidden"});$(this).parent().nextAll().css({visibility:"hidden"}).slideUp(c.crossSpeed,function(){$(this).remove()});$(this).parent().addClass("currentCrumb");return false}})};if(f.css("display")=="none"){f.slideDown();g()}else{g()}i.css({visibility:"visible",left:c.width}).animate({left:0},c.crossSpeed)};if(!c.selectCategories){e.find(".ddMenu li a").each(function(){if($(this).next().is("ul")){$(this).addClass("menuIndicator").click(function(){a(this);return false})}})}e.find("."+c.nextMenuLink).click(function(){a(this);return false})};